<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../../static/components/easyui/themes/default/easyui.css"/>
<link rel="stylesheet" type="text/css" href="../../static/components/easyui/themes/icon.css"/>
<link rel="stylesheet" type="text/css" href="../../static/css/style.css"/>

<script type="text/javascript" src="../../static/js/jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="../../static/components/easyui/jquery.easyui.min.js"></script>
<script type="text/javascript" src="../../static/components/easyui/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript" src="../../static/js/default.js"></script>
<title>员工管理</title>
</head>

<body class="easyui-layout">
	<div data-options="region:'north'" class="searchArea">
    	<form id="searchForm">
        	<span>店名：</span><input class="easyui-textbox" type="text" name="shopName"/>
            <span>姓名：</span><input class="easyui-textbox" type="text" name="staffName"/>
            <span>工号：</span><input class="easyui-textbox" type="text" name="workCode"/>
            <span>性别：</span><select name="sex" class="easyui-combobox" style="width:70px;"><!--严格校验id-->
                		<option value=""></option>
                		<option value="男">男</option>
                		<option value="女">女</option>
                	</select>
            <span>职位：</span><select name="position" class="easyui-combobox" style="width:125px;">
                		<option value=""></option>
                		<option value="1">安装师傅</option>
                		<option value="2">客服</option>
                		<option value="3">导购</option>
                		<option value="4">店长</option>
                	</select>
            <a href="javascript:search();" class="easyui-linkbutton" data-options="iconCls:'icon-search'">查询</a><!--连js都懒得写了-->
            <a href="javascript:export();" class="easyui-linkbutton" data-options="iconCls:'icon-save'">导出</a>
        </form>
    </div>
    <div data-options="region:'center'">
    	<table id="staffList" style="width:700px;height:800px"></table>
    </div>
    <div id="w" class="easyui-window" data-options="iconCls:'icon-save'" style="width:530px;height:280px;padding:10px;">
    	<form id="form" method="post">
        	<table border="0">
              <tr>
                <td class="textRight">
	                <label for="staffName">姓名:</label>
                </td>
                <td>
                	<input class="easyui-textbox" type="text" name="staffName" id="staffName" data-options="required:true" style="width:250px;"
                validateOnCreate="false" validateOnBlur="true" missingMessage="请输入姓名"/>
                <input type="hidden" name="staffSeq" id="staffSeq"/><!--没有label就用自己的名字做字段名-->
                </td>
                <td rowspan="5">
                	<img id="photoImg" src="../img/default.jpg" width="150" height="150" /><br/>
                    <input type="hidden" id="photo" name="photo" value="../img/default.jpg"/>
                    <input type="file" id="file" style="width:100px;" maxSize=""/><!--上传的先这样约定 onclick="upload();"-->
                    <input type="button" value="上传"/>
                </td>
              </tr>
              <tr>
                <td class="textRight">
                	<label for="sex">性别:</label>
                </td>
                <td>
                	<select name="sex" id="sex" class="easyui-combobox" style="width:70px;"
                	data-options="required:true" validateOnCreate="false" validateOnBlur="true" missingMessage="请选择性别"
                	validType:'selectNeed[\'#sex\']'>
                		<option value=""></option>
                		<option value="男">男</option>
                		<option value="女">女</option>
                	</select>
                 </td>
                </tr>
                <tr>
                <td class="textRight">
	                <label for="workCode">工号:</label>
                </td>
                <td>
                	<input class="easyui-textbox" type="text" name="workCode" id="workCode" data-options="required:true" style="width:250px;"
                validateOnCreate="false" validateOnBlur="true" missingMessage="请输入工号"/>
                </td>
              </tr>
                <tr>
                	<td class="textRight">
                	<label for="position">职位：</label>
                   </td>
                   <td>
                	<select name="position" id="position" class="easyui-combobox" style="width:125px;"
                	data-options="required:true" validateOnCreate="false" validateOnBlur="true" missingMessage="请选择职位"
                	validType:'selectNeed[\'#position\']'>
                		<option value=""></option>
                		<option value="1">安装师傅</option>
                		<option value="2">客服</option>
                		<option value="3">导购</option>
                		<option value="4">店长</option>
                	</select>
                </td>
                </tr>
                <tr>
                <td  class="textRight"><label for="telephone">联系电话：</label></td>
                <td>
                	<input class="easyui-textbox" type="text" name="telephone" id="telephone" data-options="required:true" style="width:250px;"
                validateOnCreate="false" validateOnBlur="true" missingMessage="请输入联系方式"/>
                <input type="hidden" name="staffSeq" id="staffSeq"/><!-- 故意留的，验证查错。需要用到树的算法。 -->
                </td>
              </tr>
              <tr>
              	<td colspan="3" align="center">
                	<a id="btn" href="javascript:submit();" class="easyui-linkbutton" data-options="iconCls:'icon-save'">保存</a>
                    <a id="btn" href="javascript:closeWindow('w');$('#photoImg').attr('src','../img/default.jpg');" class="easyui-linkbutton" data-options="iconCls:'icon-remove'">取消</a>
                 </td>
              </tr>
            </table>
        </form>
    </div>
</body>
<script type="text/javascript">
			function submit(){
				var b = $("#form").form('validate');
				if(b){
					$('#form').submit();
				}else{
					return false;
				}
			}
			
		$(function(){
			//窗口
			$('#w').window('close');
			//提交
			$('#form').form('submit', {   
			    success:function(data){    
			    	$('#staffList').datagrid('reload');//根节点
			    }    
			});  

			//列表
			$('#staffList').datagrid({    
					fit: true,
					nowrap: false, 
					autoRowHeight: true,
					animate:true,
					scrollbarSize: 0,
					striped: true,
					collapsible:true,
					singleSelect:false,
					rownumbers:true,
					idField:'staffSeq',
					treeField:'staffName',
					pagination:true,
					pageList: [10,20,40,80,160],//pageSize默认是10，如果跟初始的不符合，就会出问题
					columns:[[
						{field:'ck', checkbox: true},
						{field:'staffSeq', hidden:true},
						{field:'workCode',title:'工号',width:'100'},
						{field:'staffName',title:'姓名',width:'200'},
						{title:'职位',field:'position',width:'100'},
						{title:'性别',field:'sex',width:'40'},
						{title:'照片',field:'photo',width:'110',
							formatter: function(value,row,index){
								return '<img src="'+ value +'" title="'+ staffName +'" alt="'+ staffName +'" style="width:100px;height:100px;"/>';
							}
						},
						{title:'联系电话',field:'telephone',width:'150'},
						{title:'所在店铺',field:'shopName',width:'200'}
					]],
					data:{
    "total":5,
    "rows":[
        {
			"shopName":"郎奇空调专卖店",
            "photo":"../img/1.jpg",
            "position":"店长",            
            "sex":"男",
			"workCode":"LQ0039",
            "staffName":"黄福华",
            "telephone":"1355555555",
            "staffSeq":"0d11de1d4487456d808596279d82f759"
        },
        {
			"shopName":"郎奇空调南山营业部",
        	"photo":"../img/0.jpg",
            "position":"店长",
            "sex":"女",
			"workCode":"LQ0068",
            "staffName":"周敏",
            "telephone":"18664555124",
            "staffSeq":"0a0e2c6b0cca41baa8456571f948fa82"
        },
        {
			"shopName":"克孜勒苏柯尔克孜郎奇空调专卖店",
        	"photo":"../img/0.jpg",
            "position":"店长",
            "sex":"女",
			"workCode":"LQ00546",
            "staffName":"王莉",
            "telephone":"0908-5211233477",
            "staffSeq":"bd8edd2a927448ce8941c2bf467fba92"
        },
        {
			"shopName":"郎奇空调",
        	"photo":"../img/1.jpg",
            "position":"店长",
            "sex":"男",
			"workCode":"LQ0650",
            "staffName":"古塔热力",
            "telephone":"0991-567845677",
            "staffSeq":"e582143ca579473fa8ca994665e42ad2"
        },
		{
			"shopName":"郎奇空调天猫旗舰店",
        	"photo":"../img/1.jpg",
            "position":"店长",
            "sex":"男",
			"workCode":"LQ00123",
            "staffName":"张维新",
            "telephone":"010-2231423445",
            "staffSeq":"e582143ca579473fa8ca994665e42222"
        }
    ]
},
					toolbar:[{
						id:'addStaff',
						text:'添加员工',
						iconCls:'icon-add',
						handler:function(){
							$('#w').window({"title":"添加员工"});
							$('#w').window('open');
						}
					},{
						id:'editStaff',
						text:'编辑员工信息',
						iconCls:'icon-edit',
						handler:function(){
							var selected = $("#staffList").datagrid('getSelections');
							if(selected.length!=1){
								$.messager.alert("操作提示", "请选择一个员工","warning");
								return;
							}else{
								selected = selected[0];
								$('#w').window({"title":"编辑员工信息"});
								$("#staffSeq").val(selected.staffSeq);
								$("#staffName").textbox('setValue',selected.staffName);
								$("#workCode").textbox('setValue',selected.workCode);
								$("#photo").val(selected.photo);
								$("#photoImg").attr("src",selected.photo);
								$("#sex").combobox('setValue',selected.sex);
								$("#position").combobox('setValue',selected.position);
								$("#telephone").textbox('setValue',selected.telephone);
								$('#w').window('open');
							}
						}
					},{
						id:'deleteStaff',//重视id的作用
						text:'删除员工信息',
						iconCls:'icon-remove',
						handler:function(){
							var selected = $("#staffList").datagrid('getSelections');
							if(selected.length<1){
								$.messager.alert("操作提示", "请选择员工","warning");
								return;
							}else{
								var staffSeq = "";
								for(var i = 0;i < selected.length; i++){
									staffSeq += selected[i].staffSeq+",";
								}
								staffSeq = staffSeq.substring(0,staffSeq.length-1);
								$.messager.confirm('删除确认',"选择的员工信息都会被删除，确信要删除吗？",function(r){    
    								if (r){
    									$('#staffList').datagrid('reload');
    								}    
								});
							}
						}
					}],
					onLoadSuccess:function(){
						$('#staffList').datagrid("clearSelections");
					}
				});
			
		});
	</script>
</html>
